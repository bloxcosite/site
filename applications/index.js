const template_open_nopurchase = '\x0a<div\x20clas' + 's=\x22col-sm-' + '6\x20mb-3\x20mb-' + 'sm-0\x22\x20styl' + 'e=\x22margin-' + 'bottom:\x2015' + 'px\x20!import' + 'ant;\x22>\x0a\x20\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20<di' + 'v\x20class=\x22c' + 'ard\x22\x20STYLE' + '>\x0a\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20<div\x20c' + 'lass=\x22card' + '-body\x22>\x0a\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20<h5\x20clas' + 's=\x22card-ti' + 'tle\x22>POSIT' + 'ION</h5>\x0a\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20<p\x20clas' + 's=\x22card-te' + 'xt\x22>Apply\x20' + 'to\x20become\x20' + 'POS_DESC\x20a' + 't\x20Bloxco\x20S' + 'upermarket' + '.</p><br/>' + '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20\x20<a\x20hr' + 'ef=\x22BUTTON' + '_HREF\x22\x20cla' + 'ss=\x22btn\x20BU' + 'TTON_CLASS' + '\x22\x20type=\x22bu' + 'tton\x22\x20BUTT' + 'ON_DISABLE' + 'D>Apply</a' + '>\x0a\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20</div>' + '\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20</div>\x0a\x20\x20' + '\x20\x20\x20\x20\x20\x20</di' + 'v><br/>\x0a';
const template_closed_nopurchase = '\x0a<div\x20clas' + 's=\x22col-sm-' + '6\x20mb-3\x20mb-' + 'sm-0\x22\x20styl' + 'e=\x22margin-' + 'bottom:\x2015' + 'px\x20!import' + 'ant;\x22>\x0a\x20\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20<di' + 'v\x20class=\x22c' + 'ard\x22\x20STYLE' + '>\x0a\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20<div\x20c' + 'lass=\x22card' + '-body\x22>\x0a\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20<h5\x20clas' + 's=\x22card-ti' + 'tle\x22>POSIT' + 'ION</h5>\x0a\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20<p\x20clas' + 's=\x22card-te' + 'xt\x22>The\x20PO' + 'S_DESC\x20app' + 'lication\x20i' + 's\x20closed\x20r' + 'ight\x20now.\x20' + '<a\x20href=\x22/' + 'discord.ht' + 'ml\x22\x20style=' + '\x22opacity:\x20' + '0.6;\x22>Howe' + 'ver,\x20you\x20c' + 'an\x20join\x20ou' + 'r\x20Discord\x20' + 'Server\x20and' + '\x20get\x20notif' + 'ied\x20when\x20t' + 'he\x20applica' + 'tion\x20opens' + '\x20up!</a></' + 'p>\x0a\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20<a\x20' + 'href=\x22BUTT' + 'ON_HREF\x22\x20c' + 'lass=\x22btn\x20' + 'BUTTON_CLA' + 'SS\x22\x20type=\x22' + 'button\x22\x20BU' + 'TTON_DISAB' + 'LED>Apply<' + '/a>\x0a\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20\x20\x20</di' + 'v>\x0a\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20</div>\x0a' + '\x20\x20\x20\x20\x20\x20\x20\x20</' + 'div><br/>\x0a';
const template_closed_canpurchase = '\x0a<div\x20clas' + 's=\x22col-sm-' + '6\x20mb-3\x20mb-' + 'sm-0\x22\x20styl' + 'e=\x22margin-' + 'bottom:\x2015' + 'px\x20!import' + 'ant;\x22>\x0a\x20\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20<di' + 'v\x20class=\x22c' + 'ard\x22\x20STYLE' + '>\x0a\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20<div\x20c' + 'lass=\x22card' + '-body\x22>\x0a\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20<h5\x20clas' + 's=\x22card-ti' + 'tle\x22>POSIT' + 'ION</h5>\x0a\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20<p\x20clas' + 's=\x22card-te' + 'xt\x22>The\x20PO' + 'S_DESC\x20app' + 'lication\x20i' + 's\x20closed\x20r' + 'ight\x20now.\x20' + '<a\x20href=\x22/' + 'ranks.html' + '\x22\x20style=\x22o' + 'pacity:\x200.' + '6;\x22>Howeve' + 'r,\x20you\x20can' + '\x20purchase\x20' + 'this\x20rank\x20' + 'to\x20bypass!' + '</a></p>\x0a\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20<a\x20href' + '=\x22BUTTON_H' + 'REF\x22\x20class' + '=\x22btn\x20BUTT' + 'ON_CLASS\x22\x20' + 'type=\x22butt' + 'on\x22\x20BUTTON' + '_DISABLED>' + 'Apply</a>\x0a' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20</div>\x0a\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20<' + '/div>\x0a\x20\x20\x20\x20' + '\x20\x20\x20\x20</div>' + '<br/>\x0a';
const template_open_canpurchase = '\x0a<div\x20clas' + 's=\x22col-sm-' + '6\x20mb-3\x20mb-' + 'sm-0\x22\x20styl' + 'e=\x22margin-' + 'bottom:\x2015' + 'px\x20!import' + 'ant;\x22>\x0a\x20\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20<di' + 'v\x20class=\x22c' + 'ard\x22\x20STYLE' + '>\x0a\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20<div\x20c' + 'lass=\x22card' + '-body\x22>\x0a\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20<h5\x20clas' + 's=\x22card-ti' + 'tle\x22>POSIT' + 'ION</h5>\x0a\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20' + '\x20\x20\x20<p\x20clas' + 's=\x22card-te' + 'xt\x22>Apply\x20' + 'to\x20become\x20' + 'POS_DESC\x20a' + 't\x20Bloxco\x20S' + 'upermarket' + '.\x20<a\x20href=' + '\x22/ranks.ht' + 'ml\x22\x20style=' + '\x22opacity:\x20' + '0.6;\x22>Don\x27' + 't\x20want\x20to\x20' + 'apply?\x20Pur' + 'chase\x20this' + '\x20rank.</a>' + '</p>\x0a\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20\x20<' + 'a\x20href=\x22BU' + 'TTON_HREF\x22' + '\x20class=\x22bt' + 'n\x20BUTTON_C' + 'LASS\x22\x20type' + '=\x22button\x22\x20' + 'BUTTON_DIS' + 'ABLED>Appl' + 'y</a>\x0a\x20\x20\x20\x20' + '\x20\x20\x20\x20\x20\x20\x20\x20</' + 'div>\x0a\x20\x20\x20\x20\x20' + '\x20\x20\x20\x20\x20</div' + '>\x0a\x20\x20\x20\x20\x20\x20\x20\x20' + '</div><br/' + '>\x0a';


fetch('applications.json')
  .then(response => response.json())
  .then(data => {
    function isApplicationEnabled(url, applications) {
      const application = applications.find(app => app.url === url);
      return application && application.enabled;
    }

    function generateCard(url, template, enabled, entry) {
      const position = entry.name_title
      const position_desc = entry.name_desc
      const position_with_space = ` ${position}` 

      const cardHTML = template
        .replace('POSITION', position)
        .replace('POS2', position)
        .replace('POSITIONWITHSPACE', position_with_space)
        .replace('POS3', position)
        .replace('POS_DESC', enabled ? position_desc : position)
        .replace('ENABLED', enabled ? 'open' : 'closed')
        .replace('BUTTON_CLASS', enabled ? 'btn-success' : 'btn-danger disabled')
        .replace('BUTTON_DISABLED', enabled ? '' : 'disabled')
        .replace('BUTTON_HREF', url)
        .replace('STYLE', enabled ? '' : 'style="opacity: 0.7 !important;"');

      return cardHTML;
    }

    const app = document.getElementById('loadApps');
    let closedHtml = ``

    data.applications.forEach(entry => {
        const isEnabled = isApplicationEnabled(entry.url, data.applications);
      
        let cardTemplate = `There was an error while loading the card for ${entry.url}.`;
      
        if (entry.purchasable) {
          if (entry.enabled) {
            cardTemplate = template_open_canpurchase;
          } else {
            cardTemplate = template_closed_canpurchase;
          }
        } else {
          // not purchasable
          if (entry.enabled) {
            cardTemplate = template_open_nopurchase;
          } else {
            cardTemplate = template_closed_nopurchase;
          }
        }
      
        const cardHTML = generateCard(entry.url, cardTemplate, isEnabled, entry);
        if (isEnabled && entry.showCard === true) {
          app.innerHTML += cardHTML;
        } else {
            if(entry.showCard == false) {
                console.warn(`Cannot load card for ${entry.name_title} because showCard is false. HTML: ${cardHTML}`)
            } else {
                closedHtml += cardHTML;
            }
        }
      });
      

    app.innerHTML += closedHtml

    document.querySelectorAll('.btn').forEach(button => {
      button.addEventListener('click', (event) => {
        event.preventDefault();
        window.location.href = event.target.href;
      });
    });
  })
  .catch(error => console.error('Error fetching applications.json:', error));
